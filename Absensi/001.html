<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi - si A</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 20px; background-color: #f4f7f6; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; font-size: 24px; }
        .profile-info { background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid #3498db; }
        .profile-info p { margin: 5px 0; font-weight: bold; color: #2c3e50; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #34495e; }
        select { width: 100%; padding: 12px; border: 1px solid #dcdde1; border-radius: 6px; font-size: 16px; background: white; }
        
        button { padding: 12px 24px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; width: 100%; }
        button:hover { background: #45a049; }
        button:disabled { background: #bdc3c7; cursor: not-allowed; }

        .loader { display: none; width: 18px; height: 18px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #lokasi { margin-top: 10px; font-weight: bold; color: #2980b9; text-align: center; }
        .notification { margin: 15px 0; padding: 15px; border-radius: 6px; font-weight: bold; text-align: center; }
        .success { background-color: #d4edda; color: #155724; }
        .error-msg { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Absensi Digital</h1>
        
        <div class="profile-info">
            <p>Nama: <span>si A</span></p>
            <p>ID: <span>100</span></p>
        </div>
        
        <div class="form-group">
            <label for="keterangan">Pilih Keterangan:</label>
            <select id="keterangan" required>
                <option value="Awal Masuk">Awal Masuk</option>
                <option value="Pulang">Pulang</option>
                <option value="Ijin Keluar">Ijin Keluar</option>
                <option value="Datang Lagi">Datang Lagi</option>
            </select>
        </div>
        
        <div class="form-group">
            <button id="locationBtn" onclick="getLocation()">
                <span id="btnText">üìç Dapatkan Lokasi</span>
                <div id="btnLoader" class="loader"></div>
            </button>
            <div id="lokasi"></div>
        </div>
        
        <div class="form-group">
            <button id="submitBtn" onclick="submitAbsensi()" style="background-color: #3498db;">Kirim Absensi Sekarang</button>
        </div>
        
        <div id="notification" class="notification"></div>
    </div>

    <script>
        // GANTI DENGAN URL WEB APP ANDA
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw5kUoQEeOjvJ6aY6ou7YKegX3_7BsCjmiMQxJmy7Nw1DwX_TFVKHxFO48375k-90KPqw/exec';
        
        const USER_ID = "100";
        const USER_NAMA = "si A";

        let currentLocation = null;

        function getLocation() {
            const btn = document.getElementById('locationBtn');
            const btnText = document.getElementById('btnText');
            const loader = document.getElementById('btnLoader');

            btn.disabled = true;
            btnText.innerText = "Mencari GPS...";
            loader.style.display = "inline-block";

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        currentLocation = { lat: position.coords.latitude, lng: position.coords.longitude };
                        document.getElementById('lokasi').innerHTML = "‚úÖ Lokasi Terdeteksi";
                        btn.disabled = false;
                        btnText.innerText = "Update Lokasi";
                        loader.style.display = "none";
                    },
                    error => {
                        btn.disabled = false;
                        btnText.innerText = "Dapatkan Lokasi";
                        loader.style.display = "none";
                        alert("Gagal ambil lokasi. Pastikan GPS HP aktif!");
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            }
        }

        async function submitAbsensi() {
            if (!currentLocation) { alert('Ambil lokasi dulu!'); return; }
            
            const submitBtn = document.getElementById('submitBtn');
            const notificationDiv = document.getElementById('notification');
            const ketSelect = document.getElementById('keterangan');

            submitBtn.disabled = true;
            submitBtn.innerText = "Proses Mengirim...";

            const waktuNow = new Date();
            const dataKirim = {
                tanggal: `${waktuNow.getDate()}-${waktuNow.getMonth()+1}-${waktuNow.getFullYear()}`,
                jam: waktuNow.getHours().toString().padStart(2, '0') + ":" + waktuNow.getMinutes().toString().padStart(2, '0') + ":" + waktuNow.getSeconds().toString().padStart(2, '0'),
                id: USER_ID,
                nama: USER_NAMA,
                keterangan: ketSelect.value,
                lokasi: `https://www.google.com/maps?q=${currentLocation.lat},${currentLocation.lng}`
            };

            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(dataKirim) });
                notificationDiv.textContent = '‚úÖ Absen Berhasil Tersimpan!';
                notificationDiv.className = 'notification success';
                document.getElementById('lokasi').innerHTML = '';
                currentLocation = null;
            } catch (e) {
                notificationDiv.textContent = '‚ùå Gagal Terkirim!';
                notificationDiv.className = 'notification error-msg';
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerText = "Kirim Absensi Sekarang";
            }
        }
    </script>
</body>
</html>
